<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="icon" href="/static/favicon.ico" sizes="32x32">
    <link rel="stylesheet" href="/static/css/site.css" type="text/css">
    <title>APIs demonstrating the power of k6</title>
</head>
<body>
<main class="page">
    <header class="header">
        <div class="logo">
            <svg xmlns="http://www.w3.org/2000/svg" width="220.227" height="213.73" viewBox="0 0 220.227 213.73">
                <path d="M220.727,213.731H.5L73.815,57.346l44.163,32.466L175.581,0Zm-80.746-33.778h.471a21.028,21.028,0,0,0,14.619-5.876,19.166,19.166,0,0,0,6.284-14.454,17.546,17.546,0,0,0-6.057-13.873,18.426,18.426,0,0,0-12.568-5.412h-.361a6.567,6.567,0,0,0-1.83.251l11.626-17.282-9.262-6.465-4.383,6.465-11.2,17.109c-1.925,2.836-3.535,5.334-4.533,7.07a40.655,40.655,0,0,0-2.663,5.726,17.816,17.816,0,0,0-1.272,6.6,19.145,19.145,0,0,0,6.206,14.3,20.709,20.709,0,0,0,14.485,5.876Zm-49.237-18.6,12.836,18.154H117.3l-15.1-21.06,13.41-18.617-8.9-6.159-3.927,5.184-12.058,17V121.674l-12.019-9.8V179.5H90.727V161.336ZM140,168.618a8.837,8.837,0,1,1,0-17.675h.079a8.639,8.639,0,0,1,6.229,2.663,8.228,8.228,0,0,1,2.663,6.127A8.978,8.978,0,0,1,140,168.6Z"
                      transform="translate(-0.5 -0.001)" fill="#7d64ff"/>
            </svg>
        </div>
        <div>
            <h1 class="title">test-api.<span class="text-blue">k6</span>.io</h1>
            <p class="description">Collection of HTTP and WebSocket APIs demonstrating the power of k6</p>
        </div>
        <ul class="header-icons">
            <li>
                <a href="https://github.com/grafana/k6">
                    <svg height="20" width="20" aria-hidden="true" focusable="false"
                         viewBox="0 0 496 512">
                        <path fill="currentColor"
                              d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path>
                    </svg>
                </a>
            </li>
            <li>
                <a href="https://twitter.com/k6_io">
                    <svg height="20" width="20" aria-hidden="true" focusable="false"
                         viewBox="0 0 512 512">
                        <path fill="currentColor"
                              d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"></path>
                    </svg>
                </a>
            </li>
        </ul>
    </header>
    <section class="page-section">
        <h1>HTTP REST APIs</h1>
        <h2 class="heading-underlined">Public APIs</h2>
        <table>
            <tbody>
            <tr>
                <td>GET</td>
                <td><a href="/public/crocodiles/">/public/crocodiles/</a></td>
                <td>Public endpoint. List all public crocodiles.</td>
            </tr>
            <tr>
                <td>GET</td>
                <td><a href="/public/crocodiles/1/">/public/crocodiles/{id}/</a></td>
                <td>Public endpoint. Get a single public crocodile.</td>
            </tr>
            </tbody>
        </table>

        <h2 class="heading-underlined">Registration and authentication</h2>
        <table>
            <tbody>
            <tr>
                <td>POST</td>
                <td><a href="/user/register/">/user/register/</a></td>
                <td>Public endpoint. Register a new user.</td>
            </tr>

            <tr>
                <td>POST</td>
                <td><a href="/auth/cookie/login/">/auth/cookie/login/</a></td>
                <td>Public endpoint. Cookie/Session based authentication login.</td>
            </tr>
            <tr>
                <td>POST</td>
                <td><a href="/auth/cookie/logout/">/auth/cookie/logout/</a></td>
                <td>Private endpoint. Cookie/Session logout.</td>
            </tr>
            <tr>
                <td>POST</td>
                <td><a href="/auth/cookie/login/">/auth/basic/login/</a></td>
                <td>Public endpoint. HTTP basic-auth login.</td>
            </tr>
            <tr>
                <td>POST</td>
                <td><a href="/auth/token/login/">/auth/token/login/</a></td>
                <td>Public endpoint. Bearer/JWT token authentication.</td>
            </tr>
            </tbody>
        </table>

        <h2 class="heading-underlined">Private APIs </h2>
        <table>
            <tbody>
            <tr>
                <td>GET</td>
                <td><a href="/my/crocodiles/">/my/crocodiles/</a></td>
                <td>Private endpoint. List all your crocodiles</td>
            </tr>
            <tr>
                <td>GET</td>
                <td><a href="/my/crocodiles/{}/">/my/crocodiles/{id}/</a></td>
                <td>Private endpoint. Get a single crocodile.</td>
            </tr>
            <tr>
                <td>POST</td>
                <td><a href="/my/crocodiles/">/my/crocodiles/</a></td>
                <td>Private endpoint. Create a new crocodile (max 100).</td>
            </tr>
            <tr>
                <td>PUT</td>
                <td><a href="/my/crocodiles/{}/">/my/crocodiles/{id}/</a></td>
                <td>Private endpoint. Update your crocodile.</td>
            </tr>
            <tr>
                <td>PATCH</td>
                <td><a href="/my/crocodiles/{}/">/my/crocodiles/{id}/</a></td>
                <td>Private endpoint. Update selected fields on your crocodile.</td>
            </tr>
            <tr>
                <td>DELETE</td>
                <td><a href="/my/crocodiles/{}/">/my/crocodiles/{id}/</a></td>
                <td>Private endpoint. Remove your crocodile.</td>
            </tr>
            </tbody>
        </table>
        <h2 class="heading-underlined">WebSocket APIs</h2>
        <table>
            <tbody>
            <tr>
                <td>CONNECT</td>
                <td colspan="2"><a href="/public/crocodiles/">/ws/crocochat/{room-name}/</a></td>
                <td>WS URL to join chat in {room-name}.</td>
            </tr>
            <tr>
                <td>message out<br>SET_NAME</td>
                <td colspan="2">
                    <pre><code class="code narrow language-js">{
  "event": "SET_NAME",
  "new_name": "MyName"
}</code></pre></td>
                <td>Outgoing WebSocket message. Sets the User name in the chat</td>
            </tr>
            <tr>
                <td>message out<br>SAY</td>
                <td colspan="2">
                    <pre><code class="code narrow language-js">{
  "event": "SAY",
  "message": "Hello"
}</code></pre></td>
                <td>Outgoing WebSocket message. Sends message to everyone in the room</td>
            </tr>
            <tr>
                <td>message in<br>USER_JOINED</td>
                <td colspan="2">
                    <pre><code class="code narrow language-js">{
  "event": "USER_JOINED",
  "user": "username",
  "room": "room-name"
}</code></pre></td>
                <td>Incoming WebSocket message. Someone joined the chat</td>
            </tr>
            <tr>
                <td>message in<br>CHAT_MSG</td>
                <td colspan="2">
                    <pre><code class="code narrow language-js">{
  "event": "CHAT_MSG",
  "user": "username",
  "room": "room-name",
  "message": "message"
}</code></pre></td>
                <td>Incoming WebSocket message. Received by everyone in the room after user sends a `SAY` message</td>
            </tr>
            <tr>
                <td>message out<br>LEAVE</td>
                <td colspan="2">
                    <pre><code class="code narrow language-js">{
  "event": "LEAVE",
  "user": "username",
  "room": "room-name"
}</code></pre></td>
                <td>Incoming/outgoing WebSocket message. Sent by user who wants to leave. Received by everyone in the room</td>
            </tr>
            </tbody>
        </table>
    </section>

    <section class="page-section">
        <h2>Sample HTTP API test script</h2>

        <pre>
<code class="code language-js">import { describe } from 'https://jslib.k6.io/functional/0.0.3/index.js';
import { Httpx, Request, Get, Post } from 'https://jslib.k6.io/httpx/0.0.2/index.js';
import { randomIntBetween, randomItem } from "https://jslib.k6.io/k6-utils/1.1.0/index.js";

export let options = {
  thresholds: {
    checks: [{threshold: 'rate == 1.00', abortOnFail: true}],
  },
  vus: 1,
  iterations: 1
};

const USERNAME = `user${randomIntBetween(1, 100000)}@example.com`;  // Set your own email;
const PASSWORD = 'superCroc2019';

let session = new Httpx({baseURL: 'https://test-api.k6.io'});

export default function testSuite() {

  describe('01. Fetch public crocs', (t) => {
    let responses = session.batch([
      new Get('/public/crocodiles/1/'),
      new Get('/public/crocodiles/2/'),
      new Get('/public/crocodiles/3/'),
      new Get('/public/crocodiles/4/'),
    ], {
      tags: {name: 'PublicCrocs'},
    });

    responses.forEach(response => {
      t.expect(response.status).as("response status").toEqual(200)
        .and(response).toHaveValidJson()
        .and(response.json('age')).as('croc age').toBeGreaterThan(7);
    });
  })

  describe(`02. Create a test user ${USERNAME}`, (t) => {

    let resp = session.post(`/user/register/`, {
      first_name: 'Crocodile',
      last_name: 'Owner',
      username: USERNAME,
      password: PASSWORD,
    });

    t.expect(resp.status).as("status").toEqual(201)
      .and(resp).toHaveValidJson();
  })

  describe(`03. Authenticate the new user ${USERNAME}`, (t) => {

    let resp = session.post(`/auth/token/login/`, {
      username: USERNAME,
      password: PASSWORD
    });

    t.expect(resp.status).as("Auth status").toBeBetween(200, 204)
      .and(resp).toHaveValidJson()
      .and(resp.json('access')).as("auth token").toBeTruthy();

    let authToken = resp.json('access');
    // set the authorization header on the session for the subsequent requests.
    session.addHeader('Authorization', `Bearer ${authToken}`);

  })

  describe('04. Create a new crocodile', (t) => {
    let payload = {
      name: `Croc Name`,
      sex: randomItem(["M", "F"]),
      date_of_birth: '2019-01-01',
    };

    let resp = session.post(`/my/crocodiles/`, payload);

    t.expect(resp.status).as("Croc creation status").toEqual(201)
      .and(resp).toHaveValidJson();

    session.newCrocId=resp.json('id');
  })

  describe('05. Fetch private crocs', (t) => {

    let response = session.get('/my/crocodiles/');

    t.expect(response.status).as("response status").toEqual(200)
      .and(response).toHaveValidJson()
      .and(response.json().length).as("number of crocs").toEqual(1);
  })

  describe('06. Update the croc', (t) => {
    let payload = {
      name: `New name`,
    };

    let resp = session.patch(`/my/crocodiles/${session.newCrocId}/`, payload);

    t.expect(resp.status).as("Croc patch status").toEqual(200)
      .and(resp).toHaveValidJson()
      .and(resp.json('name')).as('name').toEqual('New name');

    let resp1 = session.get(`/my/crocodiles/${session.newCrocId}/`);

  })

  describe('07. Delete the croc', (t) => {

    let resp = session.delete(`/my/crocodiles/${session.newCrocId}/`);

    t.expect(resp.status).as("Croc delete status").toEqual(204);
  });

}

</code></pre>
    </section>

    <section class="page-section">
        <h2>Sample WebSocket API test script</h2>

        <pre>
<code class="code language-js">
import { randomString, randomIntBetween } from "https://jslib.k6.io/k6-utils/1.1.0/index.js";
import ws from 'k6/ws';
import { check, sleep } from 'k6';

let sessionDuration = randomIntBetween(5000, 60000); // user session between 5s and 1m
let chatRoomName = 'publicRoom'; // choose your chat room name

export let options = {
  vus: 10,
  iterations: 10,
};

export default function () {
  let url = `wss://test-api.k6.io/ws/crocochat/${chatRoomName}/`;
  let params = { tags: { my_tag: 'my ws session' } };

  let res = ws.connect(url, params, function (socket) {
    socket.on('open', function open() {
      console.log(`VU ${__VU}: connected`);

      socket.send(JSON.stringify({'event': 'SET_NAME', 'new_name': `Croc ${__VU}`}));

      socket.setInterval(function timeout() {
        socket.send(JSON.stringify({'event': 'SAY', 'message': `I'm saying ${randomString(5)}`}));
      }, randomIntBetween(2000, 8000)); // say something every 2-8seconds
    });

    socket.on('ping', function () {
      console.log('PING!');
    });

    socket.on('pong', function () {
      console.log('PONG!');
    });

    socket.on('close', function () {
      console.log(`VU ${__VU}: disconnected`);
    });

    socket.on('message', function (message){
      let msg = JSON.parse(message);
      if(msg.event === 'CHAT_MSG'){
        console.log(`VU ${__VU} received: ${msg.user} says: ${msg.message}`)
      }
      else if(msg.event === 'ERROR'){
        console.error(`VU ${__VU} received:: ${msg.message}`)
      }
      else{
        console.log(`VU ${__VU} received unhandled message: ${msg.message}`)
      }
    });

    socket.setTimeout(function () {
      console.log(`VU ${__VU}: ${sessionDuration}ms passed, leaving the chat`);
      socket.send(JSON.stringify({'event': 'LEAVE'}));

    }, sessionDuration);

    socket.setTimeout(function () {
      console.log(`Closing the socket forcefully 3s after graceful LEAVE`);
      socket.close();
    }, sessionDuration+3000);
  });

  check(res, { 'Connected successfully': (r) => r && r.status === 101 });
}

</code></pre>
    </section>


</main>
<script src="/static/js/prisms.js"></script>
</body>
</html>
